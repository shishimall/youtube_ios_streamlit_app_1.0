# yusuke_ios_streamlit_app

import streamlit as st
from yt_dlp import YoutubeDL

st.set_page_config(page_title="ğŸ“± iOSå‘ã‘å‹•ç”»ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰", layout="centered")

st.title("ğŸ“¥ iOSå°‚ç”¨ å‹•ç”»ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãƒªãƒ³ã‚¯ç”Ÿæˆ")
st.markdown("ä»¥ä¸‹ã«å‹•ç”»ã®URLã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚iOS Safariã§å†ç”Ÿãƒ»é•·æŠ¼ã—ä¿å­˜ãŒå¯èƒ½ã§ã™ã€‚")

url = st.text_input("ğŸï¸ å‹•ç”»URLã‚’å…¥åŠ›", placeholder="https://www.youtube.com/watch?v=XXXXXXX")

if st.button("ğŸ”— ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãƒªãƒ³ã‚¯ã‚’å–å¾—"):
    if not url.strip():
        st.warning("URLã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚")
    else:
        with st.spinner("å‹•ç”»æƒ…å ±ã‚’å–å¾—ä¸­..."):
            try:
                ydl_opts = {
                    'quiet': True,
                    'skip_download': True,
                    'noplaylist': True,
                }
                with YoutubeDL(ydl_opts) as ydl:
                    info = ydl.extract_info(url, download=False)
                    formats = info.get("formats", [])
                    best = next((f for f in formats if f.get("ext") == "mp4" and f.get("acodec") != "none"), None)
                    video_url = best.get("url") if best else None
                    title = info.get("title", "video")

                if video_url:
                    st.success("âœ… ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãƒªãƒ³ã‚¯ã‚’å–å¾—ã—ã¾ã—ãŸï¼")
                    st.video(video_url)
                    st.markdown(f"[ğŸ“¥ é•·æŠ¼ã—ã—ã¦ä¿å­˜: {title}]({video_url})", unsafe_allow_html=True)
                else:
                    st.error("âŒ å†ç”Ÿå¯èƒ½ãªãƒªãƒ³ã‚¯ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚")
            except Exception as e:
                st.error(f"âŒ ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: {e}")
